# Gemini Sheet Builder

Веб-интерфейс для генерации изображений через Gemini. Промт разбивается на блоки для удобной сегментации, а результаты появляются в виде карточек с быстрыми действиями: апрув или регенерация.

## Возможности
- Веб UI на Flask с современными карточками.
- Блочный конструктор промта: добавляйте столько частей, сколько нужно для разных аспектов сцены.
- Выбор соотношения сторон и разрешения (1K/2K/4K) для каждой генерации.
- История генераций с превью изображений и текстовыми ответами модели.
- Быстрые действия: регенерация конкретной карточки или отметка понравившегося результата.
- Автосохранение изображений и метаданных в папку `output`.

## Установка зависимостей
```bash
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\\Scripts\\activate
pip install -r requirements.txt
```

## Запуск
```bash
python -m src.app
```

По умолчанию сервер стартует на `http://localhost:5000`. Укажите API-ключ Gemini в интерфейсе (он не сохраняется) или заранее задайте переменную окружения `GEMINI_API_KEY`.

## Использование
1. Добавьте один или несколько блоков промта и заполните их текстом.
2. Выберите соотношение сторон и разрешение.
3. Нажмите **Запустить генерацию** — после ответа модели карточка появится в истории.
4. Напротив каждой карточки доступны кнопки **Апрув** и **Регенерировать**. Для регенерации можно ввести ключ заново или использовать переменную окружения.
5. Все изображения и JSON-метаданные сохраняются в каталоге `output/`. Файлы выдаются через эндпоинт `/assets/<имя файла>`.

## Замечания
- Для сохранения метаданных используется формат `SheetRecord` из `src/storage.py`.
- Секретный ключ Flask можно переопределить через переменную `FLASK_SECRET_KEY`.

## Обновление репозитория
1. Убедитесь, что локальные изменения сохранены или отложены:
   ```bash
   git status
   git stash           # при необходимости временно спрятать правки
   ```
2. Подтяните актуальное состояние основной ветки:
   ```bash
   git pull --rebase origin main
   ```
3. При обновлении зависимостей переустановите их в виртуальном окружении:
1. Перейдите в корень проекта и подтяните последние изменения:
   ```bash
   git pull origin main
   ```
2. При обновлении зависимостей не забудьте переустановить их:
   ```bash
   source .venv/bin/activate  # если виртуальное окружение уже создано
   pip install -r requirements.txt
   ```
4. Верните сохранённые правки (если использовался `git stash`):
   ```bash
   git stash pop
   ```
5. Перезапустите приложение (`python -m src.app`) и убедитесь, что генерация работает.
3. После обновления перезапустите приложение (`python -m src.app`).

## Единый визуальный стиль
В генерацию автоматически добавляется скрытый системный промт, который заставляет все карточки выглядеть как части одной коллекции: общий тёплый фон, единый гротескный шрифт и аккуратные рамки. Главный персонаж остаётся узнаваемым, но меняет позы, эмоции и ракурсы, поэтому кадры не повторяются.
